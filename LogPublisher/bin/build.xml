<project name="raptor build tracking log publisher" default="publish" basedir=".">
    
	<property name="maven.repo.baseurl" value="http://nxraptor.qa.ebay.com/content/repositories/releases/com/ebay/build/profiler/LogPublisher"/>
										     
	<property name="git.repo.baseurl" value="https://github.scm.corp.ebay.com/DevExTech/maven-time-tracking/raw/master/LogPublisher/bin/"/>
	
	
	<property name="lib.dir" value="${basedir}/lib"/>
	<property name="logs.dir" value="${basedir}/logs"/>
	
	<property name="jar.prefix" value="LogPublisher"/>
	<property name="jar.postfix" value="jar-with-dependencies.jar"/>
	
	<property name="key.name" value="LogPublisher-Jar-KEY"/>
	
	<target name="init">
		<loadresource property="remote.version" failonerror="false">
		  <url url="${git.repo.baseurl}LogPublisher-Jar-KEY"/>
		</loadresource>
		
		<loadresource property="local.version" failonerror="false">
		  <file file="${lib.dir}/${key.name}"/>
		</loadresource>

		<condition property="uptodate">
			<equals arg1="${local.version}" arg2="${remote.version}" casesensitive="false" trim="true"/>
		</condition>
		
		<property name="current.jar.file" value="${jar.prefix}-${local.version}-${jar.postfix}"/>
		<property name="latest.jar.file" value="${jar.prefix}-${remote.version}-${jar.postfix}"/>
		
		<property name="remote.jar.fullurl" value="${maven.repo.baseurl}/${remote.version}/${latest.jar.file}"/>
		<property name="remote.key.file" value="${git.repo.baseurl}/${key.name}"/>
		
	</target>

	<target name="download" unless="uptodate">		
	    <echo message="New RaptorBuildTracking LogPublisher version found ${remote.version}"/>
		<mkdir dir="${lib.dir}"/>
		<mkdir dir="${logs.dir}"/>
		<delete file="${lib.dir}/${current.jar.file}" failonerror="false"/>
		<delete file="${lib.dir}/${key.name}" failonerror="false"/>
		<get src="${remote.jar.fullurl}" dest="${lib.dir}/${latest.jar.file}"/>
		<get src="${remote.key.file}" dest="${lib.dir}/${key.name}"/>
	</target>

	
	<target name="publish" depends="init, download">
	    <echo message="Raptor Build Tracking Log Publishing..."/>
		<java jar="${lib.dir}/${latest.jar.file}" fork="true">
		    <arg value="${logs.dir}"/>
		</java>
	</target>
	
</project>